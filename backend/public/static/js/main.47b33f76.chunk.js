(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{289:function(e,t,n){},290:function(e,t,n){},425:function(e,t,n){},474:function(e,t,n){},475:function(e,t,n){},476:function(e,t,n){},477:function(e,t,n){},478:function(e,t,n){},481:function(e,t,n){},482:function(e,t,n){},483:function(e,t,n){},484:function(e,t,n){},485:function(e,t,n){},486:function(e,t,n){},487:function(e,t,n){},488:function(e,t,n){},489:function(e,t,n){},801:function(e,t,n){},802:function(e,t,n){},803:function(e,t,n){},804:function(e,t,n){},805:function(e,t,n){},806:function(e,t,n){},807:function(e,t,n){},808:function(e,t,n){},809:function(e,t,n){},810:function(e,t,n){},811:function(e,t,n){},812:function(e,t,n){},813:function(e,t,n){},814:function(e,t,n){},815:function(e,t,n){},816:function(e,t,n){},817:function(e,t,n){},818:function(e,t,n){},819:function(e,t,n){},820:function(e,t,n){},821:function(e,t,n){},822:function(e,t,n){},823:function(e,t,n){},825:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),s=n(111),r=n.n(s),o=n(21),i=n(5),l=n(82),u=n(427),d=n(428),j=(n(442),n(2)),h="SET_USER",b="LOAD_USER",m="AUTH_ERROR",O="RESET_USER",f="LOGOUT_USER",p="CHANGE_PROFILE_PHOTO";function g(e){localStorage.setItem("HELOMI_USER",JSON.stringify(e))}function _(e){localStorage.setItem("HELOMI_USER_TOKEN",JSON.stringify(e))}function v(){try{return JSON.parse(localStorage.getItem("HELOMI_USER_TOKEN"))}catch(e){return null}}var x,N={currentUser:null,token:"",twilioAccessToken:"",isLoggedIn:!1,isLoading:!0},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case b:return Object(j.a)({},e);case h:return g(a.user),_(a.token),Object(j.a)(Object(j.a)({},e),{},{currentUser:a.user,token:a.token,twilioAccessToken:a.twilioAccessToken,isLoggedIn:!0,isLoading:!1});case p:return Object(j.a)(Object(j.a)({},e),{},{currentUser:Object(j.a)(Object(j.a)({},e.currentUser),{},{photo:a.fileName})});case m:case O:case f:return localStorage.removeItem("HELOMI_USER"),localStorage.removeItem("HELOMI_USER_TOKEN"),{currentUser:null,token:"",isLoggedIn:!1,isLoading:!1};default:return e}},y=n(64),w=n(40),T="FETCH_CHAT_MSGS",k="ADD_NEW_MSG",S="MARK_MSGS_AS_READ",I="RESET_MSGS",E={messages:{}},A=function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,a=arguments.length>1?arguments[1]:void 0,c=a.type,s=a.payload;switch(c){case T:var r=s.chatId,o=s.msgs;return Object(j.a)(Object(j.a)({},n),{},{messages:Object(j.a)(Object(j.a)({},n.messages),{},Object(y.a)({},r,(null===(e=n.messages[r])||void 0===e?void 0:e.length)?[].concat(Object(w.a)(o),Object(w.a)(n.messages[r])):Object(w.a)(o)))});case k:var i=s.chatId,l=s.msg;return Object(j.a)(Object(j.a)({},n),{},{messages:Object(j.a)(Object(j.a)({},n.messages),{},Object(y.a)({},i,(null===(t=n.messages[i])||void 0===t?void 0:t.length)?[].concat(Object(w.a)(n.messages[i]),[l]):[l]))});case S:var u=s.msgIdsArr,d=s.chatId;return console.log(u,n.messages[d]),Object(j.a)(Object(j.a)({},n),{},{messages:Object(j.a)(Object(j.a)({},n.messages),{},Object(y.a)({},d,n.messages[d].map((function(e){return u.includes(e._id)?Object(j.a)(Object(j.a)({},e),{},{isRead:!0}):Object(j.a)({},e)}))))});case I:return{messages:{}};default:return n}},R="ADD_ALERT",L="REMOVE_ALERT",M={alerts:[]},U=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case R:return{alerts:[a.alert].concat(Object(w.a)(e.alerts))};case L:return{alerts:e.alerts.filter((function(e){return e.id!==a.id}))};default:return e}},D="SET_CHATS",P="SOMEONE_IS_TYPING",F="SET_CHAT_MSGS_LOADING",G="ADD_CHAT",V="DELETE_CHAT",H="RESET_CHATS",W={chats:[]},B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case D:return Object(j.a)(Object(j.a)({},e),{},{chats:a.chats.map((function(e){return Object(j.a)(Object(j.a)({},e),{},{isOnline:!1,isTyping:!1,isLoadingMsgs:!0})}))});case P:return Object(j.a)(Object(j.a)({},e),{},{chats:e.chats.map((function(e){return e._id===a.chatId?Object(j.a)(Object(j.a)({},e),{},{isTyping:a.isTyping}):Object(j.a)({},e)}))});case F:var c=a.isLoading;return Object(j.a)(Object(j.a)({},e),{},{chats:e.chats.map((function(e){return e._id===a.chatId?Object(j.a)(Object(j.a)({},e),{},{isLoadingMsgs:c}):Object(j.a)({},e)}))});case G:return Object(j.a)(Object(j.a)({},e),{},{chats:[].concat(Object(w.a)(e.chats),[Object(j.a)(Object(j.a)({},a.chat),{},{isTyping:!1,isLoadingMsgs:!0})])});case V:return Object(j.a)(Object(j.a)({},e),{},{chats:e.chats.filter((function(e){return e._id!==a.chatId}))});case H:return{chats:{}};default:return e}},z="RING",J="STOP_RINGING",K="START_CALL",Y="SET_RTC_OFFER",q="SET_RTC_ANSWER",Z="SET_RTC_CANDIDATE",X="ACCEPT_CALL",Q="CALL_CONNECTED",$="CALL_DISCONNECTED",ee="ADD_VIDEOCALL_MSG",te="ZOOM_TO_FULLSCREEN",ne="EXIT_FULLSCREEN",ae="SET_IS_ADDING_NEW_PEER_TO_CALL",ce="END_CALL",se={call:{caller:null,callingWho:null,roomId:null,offer:null,answer:null,candidate:null,chatMsgs:[],isMuted:!0,videoStopped:!1,isConnected:!1,callEnded:!0},isRinging:!1,isOnCall:!1,isFullscreen:!1,isAddingNewPeerToCall:!1},re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case z:var c=a.caller,s=a.roomId;return Object(j.a)(Object(j.a)({},e),{},{call:Object(j.a)(Object(j.a)({},e.call),{},{caller:c,roomId:s}),isRinging:!0});case Q:return Object(j.a)(Object(j.a)({},e),{},{call:Object(j.a)(Object(j.a)({},e.call),{},{isConnected:!0})});case $:return Object(j.a)(Object(j.a)({},e),{},{call:Object(j.a)(Object(j.a)({},e.call),{},{isConnected:!1})});case J:return Object(j.a)(Object(j.a)({},e),{},{isRinging:!1});case K:return Object(j.a)(Object(j.a)({},e),{},{call:Object(j.a)(Object(j.a)({},e.call),{},{caller:a.caller,callingWho:a.callingWho,roomId:a.roomId}),isOnCall:!0});case Y:return Object(j.a)(Object(j.a)({},e),{},{call:Object(j.a)(Object(j.a)({},e.call),{},{offer:a.offer})});case q:return Object(j.a)(Object(j.a)({},e),{},{call:Object(j.a)(Object(j.a)({},e.call),{},{answer:a.answer})});case Z:return Object(j.a)(Object(j.a)({},e),{},{call:Object(j.a)(Object(j.a)({},e.call),{},{candidate:a.candidate})});case X:return Object(j.a)(Object(j.a)({},e),{},{isOnCall:!0});case ee:return Object(j.a)(Object(j.a)({},e),{},{call:Object(j.a)(Object(j.a)({},e.call),{},{chatMsgs:[].concat(Object(w.a)(e.call.chatMsgs),[a.msg])})});case ce:return{call:{caller:null,callingWho:null,roomId:null,offer:null,answer:null,candidate:null,chatMsgs:[],isMuted:!0,videoStopped:!1,isConnected:!1,callEnded:!0},isRinging:!1,isOnCall:!1,isFullscreen:!1,isAddingNewPeerToCall:!1};case te:return Object(j.a)(Object(j.a)({},e),{},{isFullscreen:!0});case ne:return Object(j.a)(Object(j.a)({},e),{},{isFullscreen:!1});case ae:return Object(j.a)(Object(j.a)({},e),{},{isAddingNewPeerToCall:a.boolVal});default:return e}},oe="TOGGLE_APP_THEME",ie=function(e){return"light"===e?"dark":"light"},le=function(e){return localStorage.setItem("HELOMI_APP_SETTINGS",JSON.stringify(e))},ue={theme:(null===(x=function(){try{return JSON.parse(localStorage.getItem("HELOMI_APP_SETTINGS"))}catch(e){return{theme:"light"}}}())||void 0===x?void 0:x.theme)||"light"},de=Object(l.combineReducers)({msg:A,user:C,alert:U,chat:B,videocall:re,appsettings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case oe:var n=ie(e.theme);return le(Object(j.a)(Object(j.a)({},e),{},{theme:n})),{theme:n};default:return e}}}),je=[d.a];var he=Object(l.createStore)(de,Object(u.composeWithDevTools)(l.applyMiddleware.apply(void 0,je))),be=n(18),me=n(4),Oe=function(e){return e.user},fe=Object(me.a)([Oe],(function(e){return e.currentUser})),pe=Object(me.a)([function(e){return e.alert}],(function(e){return e.alerts})),ge=function(e){return e.videocall},_e=function(e){return e.videocall.call},ve=Object(me.a)([ge],(function(e){return e.isRinging})),xe=Object(me.a)([_e],(function(e){return e.isConnected})),Ne=Object(me.a)([ge],(function(e){return e.isOnCall})),Ce=Object(me.a)([_e],(function(e){return e.offer})),ye=(Object(me.a)([_e],(function(e){return e.answer})),Object(me.a)([_e],(function(e){return e.candidate}))),we=Object(me.a)([_e],(function(e){return e.caller})),Te=Object(me.a)([_e],(function(e){return e.callingWho})),ke=(Object(me.a)([ge],(function(e){return e.callAccepted})),Object(me.a)([_e],(function(e){return e.chatMsgs}))),Se=Object(me.a)([_e],(function(e){return e.callEnded})),Ie=Object(me.a)([ge],(function(e){return e.isFullscreen})),Ee=Object(me.a)([ge],(function(e){return e.isAddingNewPeerToCall})),Ae=Object(me.a)([_e],(function(e){return e.roomId})),Re=n(6),Le=n.n(Re),Me=n(16),Ue=n(837),De=function(e){return{type:R,payload:{alert:e}}},Pe=function(e){return{type:L,payload:{id:e}}},Fe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return function(n){setTimeout((function(){return n(Pe(e.id))}),t),n(De(e))}},Ge=n(73),Ve=n(190),He=function(e){var t=e.url,n=e.requestType,a=e.body,c=e.headers;return fetch(t,{method:n,body:a,headers:c}).then((function(e){return e.json()})).catch((function(e){console.log(e)}))},We=new(function(){function e(){Object(Ge.a)(this,e)}return Object(Ve.a)(e,[{key:"signup",value:function(e){var t=e.username,n=e.password,a=e.email;return He({url:"/users/signup",requestType:"POST",body:JSON.stringify({username:t,email:a,password:n}),headers:{"Content-Type":"application/json"}})}},{key:"login",value:function(e){var t=e.username,n=e.password;return He({url:"/users/login",requestType:"POST",body:JSON.stringify({username:t,password:n}),headers:{"Content-Type":"application/json"}})}},{key:"fetchChatMsgs",value:function(e,t){return fetch("/privatemsg/friends/".concat(t,"/msgs"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}})}},{key:"searchPeople",value:function(e,t){return fetch("/friends/search-people?username=".concat(t),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}).then((function(e){return e.json()})).catch((function(e){return e}))}},{key:"addUserAsFriend",value:function(e,t){return fetch("/friends/add/".concat(t),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}}).then((function(e){return e.json()})).catch((function(e){return e}))}},{key:"deleteFriend",value:function(e,t){return fetch("/friends/".concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)}}).then((function(e){return e.json()})).catch((function(e){return e}))}},{key:"updateUser",value:function(e,t){return fetch("/users/update-my-profile",{method:"PATCH",headers:{Authorization:"Bearer ".concat(e)},body:t}).then((function(e){return e.json()})).catch((function(e){return e}))}},{key:"authenticateToken",value:function(e){return fetch("/users/auth",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}).then((function(e){return e.json()})).catch((function(e){return e}))}}]),e}()),Be=function(e){return function(t){console.log(e),t({type:D,payload:{chats:e}})}},ze=function(e){var t=e.chatId,n=e.isLoading;return{type:F,payload:{chatId:t,isLoading:n}}};function Je(e,t){this.text=e,this.type=t}var Ke=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;return{type:h,payload:{user:e,token:t,twilioAccessToken:n}}},Ye=function(){return{type:m}};function qe(e,t){var n=e.data.user,a=e.token,c=e.twilioAccessToken,s=new Je("You have been successfully logged in","success",Object(Ue.a)());t(Fe(s)),t(Ke(n,a,c)),t(Be(n.friends))}function Ze(e,t){var n=new Je(e.message,"warning",Object(Ue.a)());t(Fe(n)),t(Ye())}function Xe(e,t){var n=new Je(e.message||"Sorry, we could not log you in. Please check your internet connection","warning",Object(Ue.a)());t(Fe(n)),t(Ye())}var Qe=function(e,t){return function(){var n=Object(Me.a)(Le.a.mark((function n(a){var c,s;return Le.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,We[e](t);case 2:c=n.sent,"success"===(s=c.status)?qe(c,a):"fail"===s?Ze(c,a):"error"===s&&Xe(c,a);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},$e=function(e,t){return{type:T,payload:{chatId:e,msgs:t}}},et=function(e,t){return{type:k,payload:{chatId:e,msg:t}}},tt=n(141),nt=n(140),at=function(e){return{type:ae,payload:{boolVal:e}}},ct=n(429),st=n.n(ct),rt=n(0),ot=st.a.connect("/");function it(e){var t=e.from,n=e.sendTo,a=e.text,c=e.sentAt;ot.emit("private-msg-out",{from:t,sendTo:n,text:a,sentAt:c}),he.dispatch(et(n,{sender:t,receiver:n,text:a,createdAt:c}))}ot.onAny((function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];console.log("EVENT: ".concat(e,", ARGS: ").concat(n))})),ot.on("new-msg-in",(function(e){var t=e.newMsg;"success"===e.status&&he.dispatch(et(t.sender,t))})),ot.on("user-is-typing",(function(e){var t=e.typist,n=e.isTyping;he.dispatch(function(e){var t=e.chatId,n=e.isTyping;return{type:P,payload:{chatId:t,isTyping:n}}}({chatId:t,isTyping:n}))})),ot.on("online-status-in",(function(e,t){alert("".concat(e," is ").concat(t))})),ot.on("incoming-videocall",(function(e){var t=e.roomId,n=e.caller,a=e.offer;he.dispatch(function(e,t,n){return function(a){a({type:Y,payload:{offer:n}}),a({type:z,payload:{caller:e,roomId:t}})}}(n,t,a))})),ot.on("incoming-video-call-msg",(function(e){he.dispatch({type:ee,payload:{msg:e}})}));var lt=Object(a.createContext)(),ut=function(e){return Object(rt.jsx)(lt.Provider,{value:{socket:ot,socketEmitPrivateMsgOut:it},children:e.children})},dt=Object(me.a)([function(e){return e.appsettings}],(function(e){return e.theme})),jt=Object(a.createContext)();var ht=Object(me.b)({appTheme:dt}),bt=Object(i.b)(ht,(function(e){return{toggleTheme:function(){return e({type:oe})}}}))((function(e){var t=e.appTheme,n=e.toggleTheme;return console.log(t,n),Object(rt.jsx)(jt.Provider,{value:{appTheme:t,toggleTheme:n},children:e.children})})),mt=n(7),Ot=n(83),ft=(n(474),function(e){var t=e.showIf,n=e.transparent,a=Object(Ot.a)(e,["showIf","transparent"]);return Object(rt.jsx)("div",Object(j.a)({className:"overlay overlay--".concat(!t&&"hidden"," ").concat(n&&"overlay--transparent")},a))});n(475);var pt=Object(me.b)({user:Oe,currentUser:fe}),gt=Object(i.b)(pt)((function(e){var t=e.user,n=(e.currentUser,e.dispatch),c=t.token,s=Object(a.useState)(""),r=Object(mt.a)(s,2),o=r[0],i=r[1],l=Object(a.useState)([]),u=Object(mt.a)(l,2),d=u[0],j=u[1],h=Object(a.useState)(!1),b=Object(mt.a)(h,2),m=b[0],O=b[1],f="dark"===Object(a.useContext)(jt).appTheme,p=function(){var e=Object(Me.a)(Le.a.mark((function e(t){var n;return Le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,We.searchPeople(c,t);case 3:n=e.sent,console.log(n.users),j(n.users),n.users.length&&O(!0),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),alert("Sorry omething went wrong. Check your internet connection");case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),g=function(e){n(function(e,t){return function(){var n=Object(Me.a)(Le.a.mark((function n(a){var c,s,r;return Le.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,We.addUserAsFriend(e,t);case 3:c=n.sent,console.log("Response: ",c),s={id:Object(Ue.a)()},n.t0=c.status,n.next="success"===n.t0?9:"fail"===n.t0||"error"===n.t0?16:19;break;case 9:return console.log(c),delete(r=c.user).friends,a({type:G,payload:{chat:r}}),s.type="success",s.text="".concat(r.username," is now your friend"),n.abrupt("break",19);case 16:return s.type="warning",s.text="fail"===c.status?c.message:"Couldn't add. Something went wrong",n.abrupt("break",19);case 19:a(De(s)),n.next=25;break;case 22:n.prev=22,n.t1=n.catch(0),console.log("In chat creators:",n.t1);case 25:case"end":return n.stop()}}),n,null,[[0,22]])})));return function(e){return n.apply(this,arguments)}}()}(c,e)),O(!1)};return Object(rt.jsxs)("div",{className:"navbar__search",children:[Object(rt.jsx)("input",{type:"text",className:"navbar__search__input navbar__search__input--".concat(m&&"suggestions-shown"," ").concat(f&&"d-theme"),placeholder:"Search people",value:o,onChange:function(e){var t=e.target.value;i(t),t?p(t):j([])},onFocus:function(e){d&&d.length&&O(!0)}}),m&&Object(rt.jsx)("div",{className:"navbar__search__suggestions ".concat(f&&"d-theme"),children:d.map((function(e){return Object(rt.jsxs)("div",{className:"navbar__search__suggestion ".concat(f&&"d-theme"),children:[Object(rt.jsx)("img",{src:"/users/".concat(e.photo),alt:"",className:"navbar__search__suggestion__photo pic pic--sm"}),Object(rt.jsx)("div",{className:"navbar__search__suggestion__user-info",children:Object(rt.jsxs)("span",{className:"navbar__search__suggestion__username",children:[e.username," ",Object(rt.jsx)("span",{className:"navbar__search__suggestion__email",children:e.email})]})}),Object(rt.jsx)("button",{className:"btn btn-md btn-primary",onClick:function(){return g(e._id)},children:"Add friend"})]},e._id)}))}),Object(rt.jsx)(ft,{showIf:m,transparent:!0,onClick:function(){O(!1)}})]})})),_t=Object(me.a)([function(e){return e.chat}],(function(e){return e.chats})),vt=Object(me.a)([_t],(function(e){return e.length})),xt=function(e){return Object(me.a)([_t],(function(t){return t.find((function(t){return t.id===e})).isLoadingMsgs}))},Nt=Object(me.a)([_t,function(e){return e.videocall.call}],(function(e,t){return e.find((function(e){return e._id===t.caller}))})),Ct=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(a.useState)(e),n=Object(mt.a)(t,2),c=n[0],s=n[1],r=function(){return s(!c)},o=function(){return s(e)};return[c,s,r,o]},yt=(n(476),Object(me.b)({user:Oe,currentUser:fe,totalChatCount:vt})),wt=Object(i.b)(yt,(function(e){return{changeProfilePhoto:function(t){return e(function(e){return{type:p,payload:{fileName:e}}}(t))},logOutUser:function(){return e((function(e){e({type:f}),e({type:H}),e({type:I})}))}}}))((function(e){var t=e.user,n=e.currentUser,c=e.changeProfilePhoto,s=e.totalChatCount,r=e.logOutUser,o="dark"===Object(a.useContext)(jt).appTheme,i=Ct(!1),l=Object(mt.a)(i,3),u=l[0],d=(l[1],l[2]),j=function(){var e=Object(Me.a)(Le.a.mark((function e(n){var a,s,r;return Le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.target.files[0],(s=new FormData).append("photo",a),e.next=5,We.updateUser(t.token,s);case 5:r=e.sent,c(r.user.photo);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(rt.jsxs)("div",{className:"navbar__myprofile",children:[Object(rt.jsxs)("div",{className:"navbar__loggedin-user ".concat(o&&"d-theme"),onClick:d,children:[Object(rt.jsx)("img",{src:"/users/".concat(n.photo),alt:"",className:"navbar__photo pic pic--sm"}),Object(rt.jsx)("span",{className:"navbar__username",children:n.username})]}),Object(rt.jsxs)("div",{className:"navbar__myprofile__dropdown ".concat(o&&"d-theme"," ").concat(u&&"navbar__myprofile__dropdown--slide-into-view"),children:[Object(rt.jsxs)("picture",{className:"navbar__myprofile__dropdown__picture",children:[Object(rt.jsx)("img",{src:"/users/".concat(n.photo),alt:"",className:"navbar__myprofile__dropdown__picture__photo"}),Object(rt.jsxs)("form",{className:"navbar__myprofile__dropdown__picture__form-upload",children:[Object(rt.jsx)("input",{type:"file",id:"profile-photo",accept:"image/*",onChange:j}),Object(rt.jsx)("label",{htmlFor:"profile-photo",children:"Change photo"})]})]}),Object(rt.jsxs)("div",{className:"navbar__myprofile__dropdown__user-details",children:[Object(rt.jsx)("span",{className:"navbar__myprofile__dropdown__username",children:n.username}),Object(rt.jsx)("span",{className:"navbar__myprofile__dropdown__email",children:n.email}),Object(rt.jsxs)("span",{className:"navbar__myprofile__dropdown__friendscount",children:[s," ","".concat(1===s?"friend":"friends")]})]}),Object(rt.jsx)("button",{className:"btn btn-md btn-primary logout",onClick:r,children:"Log out"})]})]})})),Tt=n(430),kt=n.n(Tt),St=n(431),It=n.n(St),Et=n(432),At=n.n(Et);n(477);var Rt=function(){var e=Object(a.useContext)(jt),t=e.appTheme,n=e.toggleTheme,c="dark"===t;return Object(rt.jsx)("div",{className:"navbar__theme-toggler ".concat(c&&"d-theme"),onClick:n,"data-status":"".concat(c?"Dark":"Light"),children:Object(rt.jsx)("span",{className:"navbar__theme-toggler__switch"})})};n(478);var Lt=Object(me.b)({user:Oe}),Mt=Object(i.b)(Lt)((function(e){var t=e.user.isLoggedIn,n="dark"===Object(a.useContext)(jt).appTheme;return kt.a,It.a,At.a,Object(rt.jsxs)("nav",{className:"navbar ".concat(n&&"d-theme"),children:[Object(rt.jsx)(o.b,{to:"/dashboard",className:"navbar__logo",children:"helomi"}),t&&Object(rt.jsx)(gt,{}),t&&Object(rt.jsx)(wt,{}),Object(rt.jsx)(Rt,{})]})})),Ut=(n(481),Object(me.b)({user:Oe})),Dt=Object(i.b)(Ut)((function(e){var t=e.user,n="dark"===Object(a.useContext)(jt).appTheme;return t.isLoggedIn?Object(rt.jsx)(be.a,{to:"/dashboard"}):Object(rt.jsxs)("div",{className:"home",children:[Object(rt.jsxs)("header",{className:"home__header",children:[Object(rt.jsxs)("div",{className:"home__header__textbox",children:[Object(rt.jsx)("h1",{className:"h-1 home__header__heading u-mgb-sm",children:"Enjoy the moments of communication."}),Object(rt.jsx)("p",{className:"parag u-mgb-lg",children:"Helomi is a desktop web-based chat application for making memorable communication experiences."}),Object(rt.jsx)(o.b,{to:"/signup",className:"btn btn-black btn-lg btn--rounded",children:"Get started"})]}),Object(rt.jsx)("picture",{className:"home__header__picture",children:Object(rt.jsx)("img",{className:"home__header__img",src:"/img/hero.png",alt:""})})]}),Object(rt.jsxs)("section",{className:"home__services ".concat(n&&"d-theme"),children:[Object(rt.jsxs)("div",{className:"service ".concat(n&&"d-theme"),children:[Object(rt.jsx)("span",{className:"service__icon",children:Object(rt.jsx)("span",{class:" iconify","data-icon":"ion:chatbox-ellipses"})}),Object(rt.jsxs)("div",{className:"service__textbox",children:[Object(rt.jsx)("h4",{className:"h-4 u-text-center",children:"Instant messaging"}),Object(rt.jsx)("p",{className:"parag u-text-center",children:"Send text messages at real time to your friends and loved ones for free anytime, anywhere."})]})]}),Object(rt.jsxs)("div",{className:"service ".concat(n&&"d-theme"),children:[Object(rt.jsx)("span",{className:"service__icon",children:Object(rt.jsx)("span",{class:" iconify","data-icon":"ion:videocam"})}),Object(rt.jsxs)("div",{className:"service__textbox",children:[Object(rt.jsx)("h4",{className:"h-4 u-text-center",children:"Video calling"}),Object(rt.jsx)("p",{className:"parag u-text-center",children:"Communicate with anyone through a real-time video streaming for free."})]})]})]}),Object(rt.jsxs)("footer",{className:"footer ".concat(n&&"d-theme"),children:[Object(rt.jsx)(o.b,{to:"/",className:"navbar__logo",children:"helomi"}),Object(rt.jsx)("span",{className:"footer__copyr",children:"Helomi. \xa9 Copyright 2021. All rights reserved."}),Object(rt.jsx)("span",{className:"footer__designedby",children:"Designed and powered by Chima Orji Divine."})]})]})}));var Pt=function(e){var t=e.onFocusOut,n=Object(Ot.a)(e,["onFocusOut"]);return Object(rt.jsx)("input",Object(j.a)(Object(j.a)({},n),{},{onBlur:t}))};n(482);var Ft=Object(me.b)({user:Oe,allChats:_t}),Gt=Object(be.g)(Object(i.b)(Ft)((function(e){var t=e.user.currentUser,n=e.allChats,c=(e.dispatch,"dark"===Object(a.useContext)(jt).appTheme),s=Object(a.useState)(""),r=Object(mt.a)(s,2),o=r[0],i=r[1],l=Object(a.useContext)(lt),u=l.socket,d=l.socketEmitPrivateMsgOut,j=Object(be.f)().id;Object(a.useEffect)((function(){u.emit("typing",{typist:t._id,allChats:n.map((function(e){return e._id})),isTyping:Boolean(o.length)})}),[o]);var h=function(e){null===e||void 0===e||e.preventDefault(),d({from:t._id,sendTo:j,text:o,sentAt:new Date}),i("")};return Object(rt.jsx)("div",{className:"chatting-section__footer ".concat(c&&"d-theme"),children:Object(rt.jsxs)("form",{className:"new-msg",onSubmit:h,children:[Object(rt.jsxs)("div",{className:"new-msg__group",children:[Object(rt.jsx)(Pt,{type:"text",className:"textfield textfield--message new-msg__input",placeholder:"Type a message",value:o,onChange:function(e){return i(e.target.value)}}),Object(rt.jsx)("div",{className:"icon",onClick:function(){return i("")},children:"\xd7"})]}),Object(rt.jsx)("div",{className:"icon",onClick:function(){return h()},type:"submit",children:Object(rt.jsx)("i",{className:"fas fa-paper-plane"})})]})})})));n(483);var Vt=function(e){var t=e.showIf,n=e.className,a=e.children,c=Object(Ot.a)(e,["showIf","className","children"]);return t&&Object(rt.jsx)("ul",Object(j.a)(Object(j.a)({className:n+" dropdown remove-bullets"},c),{},{children:a}))};n(484),n(289);var Ht=Object(be.g)(Object(i.b)((function(e,t){return{user:Oe(e),currentUser:fe(e),currentChat:(n=t.match.params.id,Object(me.a)([_t],(function(e){return e.find((function(e){return e._id===n}))})))(e)};var n}))((function(e){e.user;var t=e.currentChat,n=e.currentUser,c=e.dispatch,s=Object(be.f)().id,r=Object(a.useState)(!1),o=Object(mt.a)(r,2),i=o[0],l=o[1],u=Ct(!1),d=Object(mt.a)(u,3),j=d[0],h=d[1],b=(d[2],"dark"===Object(a.useContext)(jt).appTheme);return Object(rt.jsxs)("div",{className:"chatting-section__header ".concat(b&&"d-theme"),children:[Object(rt.jsxs)("div",{className:"chatting-section__header__userdetails",children:[Object(rt.jsx)("div",{className:"chatting-section__header__userphoto chatting-section__header__userphoto--".concat(i?"zoomed-in":"zoomed-out"),children:Object(rt.jsx)("img",{src:"/users/".concat(t.photo),alt:"",className:"user-img pic pic--sm",onClick:function(){return l(!0)}})}),Object(rt.jsx)("span",{className:"chatting-section__header__username",children:t.username})]}),Object(rt.jsx)("div",{className:"chatting-section__header__nav ".concat(b&&"d-theme"),children:Object(rt.jsx)("i",{className:"fas fa-video with-label with-label-at-bottom","data-label":"Start video call",onClick:function(){return c(function(e,t){return{type:K,payload:{caller:e,callingWho:t,roomId:(n=e,"videochat"+n)}};var n}(n._id,s))}})}),Object(rt.jsx)(ft,{showIf:i||j,onClick:function(){l(!1),h(!1)},transparent:j})]})}))),Wt=n(191),Bt=function(e){return e.msg},zt=Object(me.a)([Bt],(function(e){return e.messages})),Jt=function(e){return Object(me.a)([Bt],(function(t){var n;return null===(n=t.messages[e])||void 0===n?void 0:n.filter((function(t){return t.sender===e&&!t.isRead}))}))},Kt=(n(485),function(e,t){return new Intl.DateTimeFormat(window.navigator.language,t).format(e)}),Yt=function(e){var t,n={hour:"numeric",hour12:!0,minute:"numeric"},a=Math.round((t=new Date(e),((new Date).getTime()-t.getTime())/864e5));return a<1?Kt(e,n):1===a?["Yesterday",Kt(e,n)].join(", "):a<=7?"".concat(Kt(e,{weekday:"short"}),", \n         ").concat(Kt(e,n)):Kt(e,Object(j.a)(Object(j.a)({},n),{},{day:"numeric",month:"short"}))};n(290);var qt=Object(me.b)({user:Oe}),Zt=Object(i.b)(qt)((function(e){var t=e.msg,n=e.user.currentUser,c="dark"===Object(a.useContext)(jt).appTheme,s=t.sender===n._id?"outgoing":"incoming";return Object(rt.jsxs)("div",{className:"textmsg textmsg--".concat(s," ").concat(c&&"d-theme"),children:[Object(rt.jsx)("p",{className:"textmsg__content",children:t.text}),Object(rt.jsx)("p",{className:"textmsg__time",children:Yt(+new Date(t.createdAt))})]})}));function Xt(e){var t="dark"===Object(a.useContext)(jt).appTheme,n=e.allMsgs,c=e.unreadMsgs,s=e.markMsgsAsRead,r=e.isLoadingChatMsgs,o=e.fetchChatMsgs,i=e.user,l=Object(be.f)().id,u=Object(a.useContext)(lt).socket;return Object(a.useEffect)((function(){u.on("new-msg-in",(function(e){var t=e.newMsg;e.status;t.sender===l&&(u.emit("set-unreadMsgs-to-read",{unreadMsgs:c}),s(t._id,[l]))}))}),[]),Object(a.useEffect)((function(){r&&o(i.token,l),(null===c||void 0===c?void 0:c.length)&&(u.emit("set-unreadMsgs-to-read",{unreadMsgs:c}),s(c.map((function(e){return e._id})),l))}),[l]),Object(rt.jsx)(Wt.a,{children:Object(rt.jsx)("div",{className:"chatting-section__messages-box ".concat(t&&"d-theme"),children:null===n||void 0===n?void 0:n.map((function(e){return Object(rt.jsx)(Zt,{msg:e},Object(Ue.a)()+e._id)}))})})}var Qt=Object(be.g)(Object(i.b)((function(e,t){return{user:Oe(e),allMsgs:(n=t.match.params.id,Object(me.a)([Bt],(function(e){return e.messages[n]})))(e),unreadMsgs:Jt(t.match.params.id)(e),isLoadingChatMsgs:xt(t.match.params.id)(e)};var n}),(function(e){return{fetchChatMsgs:function(t,n){return e(function(e,t){return function(){var n=Object(Me.a)(Le.a.mark((function n(a){var c,s,r;return Le.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,We.fetchChatMsgs(e,t);case 3:return c=n.sent,console.log(c),n.next=7,c.json();case 7:s=n.sent,r=s.msgs,a($e(t,r)),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(0),console.log("ERR",n.t0);case 15:return n.prev=15,a(ze({chatId:t,isLoading:!1})),n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[0,12,15,18]])})));return function(e){return n.apply(this,arguments)}}()}(t,n))},markMsgsAsRead:function(t,n){return e(function(e,t){return{type:S,payload:{msgIdsArr:e,chatId:t}}}(t,n))}}}))(c.a.memo(Xt)));function $t(e){return Object.keys(e).filter((function(t){return!e[t]}))}n(486);var en=function(e){var t,n=e.size,c=e.msg,s=(e.showIf,"dark"===Object(a.useContext)(jt).appTheme),r=Object(a.useRef)();return Object(rt.jsxs)("div",{className:"loader ".concat(s&&"d-theme"),ref:r,children:[Object(rt.jsx)("div",{className:"loader__spinner loader__spinner--".concat(n," ")}),c&&Object(rt.jsx)("h4",{className:"loader__msg loader__msg--".concat(n),children:(t=c,t[0].toUpperCase()+t.slice(1).toLowerCase())})]})};n(487);var tn=Object(i.b)((function(e,t){return{isLoadingMsgs:xt(t.match.params.id)(e)}}))((function(e){var t=e.isLoadingMsgs,n="dark"===Object(a.useContext)(jt).appTheme;return Object(rt.jsx)(c.a.Fragment,{children:Object(rt.jsxs)("div",{className:"chatting-section ".concat(n&&"d-theme"),children:[Object(rt.jsx)(Ht,{}),Object(rt.jsx)(Qt,{}),Object(rt.jsx)(Gt,{}),t&&Object(rt.jsx)(en,{size:"lg",msg:"loading messages..."})]})})}));n(488),n(489);var nn=Object(me.b)({chats:_t}),an=Object(i.b)(nn)((function(e){var t=e.chats,n=(e.history,Object(a.useState)("")),c=Object(mt.a)(n,2),s=c[0],r=c[1],i=Object(a.useState)(!1),l=Object(mt.a)(i,2),u=l[0],d=l[1],j=Object(a.useState)([]),h=Object(mt.a)(j,2),b=h[0],m=h[1],O="dark"===Object(a.useContext)(jt).appTheme;return Object(a.useEffect)((function(){d(Boolean(s)),m(Object(w.a)(function(e,t){return t&&e?e.filter((function(e){return e.username.toLowerCase().startsWith(t.toLowerCase())||e.username.toLowerCase().includes(t.toLowerCase())})):[]}(t,s)))}),[s]),Object(rt.jsx)("div",{className:"search-section ".concat(O&&"d-theme"),children:Object(rt.jsxs)("form",{className:"allchats__search",onSubmit:function(){},children:[Object(rt.jsx)(Pt,{type:"text",className:"textfield allchats__search__input ".concat(O&&"d-theme"),placeholder:"Search chats",onChange:function(e){var t=e.target.value;return r(t)},onFocusOut:function(e){return setTimeout((function(){return d(!1)}),100)},onFocus:function(e){return d(Boolean(s))}}),Object(rt.jsx)("i",{className:"fas fa-search allchats__search-icon"}),Object(rt.jsx)(Vt,{showIf:u,className:"allchats__search__results remove-bullets u-full-width u-block-center ".concat(O&&"d-theme"),children:b.length?b.map((function(e){return Object(rt.jsx)(o.b,{to:"/dashboard/chats/".concat(e._id),className:"allchats__search__results__result ".concat(O&&"d-theme"),children:e.username},e.id)})):Object(rt.jsx)("span",{className:"allchats__search__results__result ".concat(O&&"d-theme"),children:"No results"})})]})})}));n(490),n(801);var cn=Object(me.b)({allReduxMsgs:zt,currentUser:fe}),sn=Object(i.b)(cn)((function(e){var t,n,c=e.chat,s=e.allReduxMsgs,r=e.currentUser,i="dark"===Object(a.useContext)(jt).appTheme,l=(null===(t=s[c._id])||void 0===t?void 0:t.slice(-1).pop())||"",u=r.id!==l.sender&&!l.isRead,d=(null===(n=s[c._id])||void 0===n?void 0:n.reduce((function(e,t){return t.sender!==c._id||t.isRead?e+0:e+1}),0))||"";return Object(rt.jsxs)(o.c,{to:"/dashboard/chats/".concat(c._id),className:"chat chat--has-unread-messages ".concat(i?"d-theme":""),activeClassName:"chat--active",children:[Object(rt.jsx)("img",{src:"/users/".concat(c.photo),alt:"",className:"chat__photo pic pic--sm"}),Object(rt.jsxs)("div",{className:"chat__info ",children:[Object(rt.jsx)("span",{className:"chat__name",children:c.username}),c.isTyping?Object(rt.jsx)("span",{className:"chat__is-typing",children:"typing..."}):Object(rt.jsx)("span",{className:"chat__lastmessage chat__lastmessage--".concat(u&&"unread"),children:l.text}),d&&Object(rt.jsx)("span",{className:"unread-messages-count",children:d})]}),Object(rt.jsx)("span",{className:"chat__time",children:"2:35 PM"})]})}));n(802);var rn=Object(me.b)({chats:_t,user:Oe,currentUser:fe}),on=Object(i.b)(rn)((function(e){var t=e.chats,n=(e.user,e.currentUser,Object(a.useContext)(lt).socket,"dark"===Object(a.useContext)(jt).appTheme);return t.length?Object(rt.jsx)("div",{className:"allchats__chatlist ".concat(n&&"d-theme"),children:t.map((function(e){return Object(rt.jsx)(sn,{chat:e},e.id)}))}):Object(rt.jsx)(en,{})}));n(803),n(804);var ln=Object(me.b)({rtcOffer:Ce,callerInChat:Nt,videocallRoomId:Ae}),un=Object(i.b)(ln)((function(e){var t=e.callerInChat,n=e.dispatch,a=null===t||void 0===t?void 0:t.username;return Object(rt.jsxs)("div",{className:"callnotify",children:[Object(rt.jsx)("i",{className:"fas fa-phone-volume callnotify__icon"}),Object(rt.jsx)("h1",{className:"callnotify__name",children:a||"(Unknown)"}),Object(rt.jsx)("p",{className:"callnotify__msg",children:"Incoming call"}),Object(rt.jsxs)("div",{className:"callnotify__user-actions",children:[Object(rt.jsx)("button",{className:"btn btn-md callnotify__user-action btn-red",onClick:function(){return n({type:J})},children:"Decline"}),Object(rt.jsx)("button",{className:"btn btn-md callnotify__user-action btn-green",onClick:function(){n({type:J}),n({type:X})},children:"Accept"})]})]})}));var dn=Object(me.b)({currentUser:fe,isRinging:ve}),jn=Object(i.b)(dn)((function(e){var t=e.currentUser,n=e.isRinging,c=Object(a.useContext)(lt).socket,s="dark"===Object(a.useContext)(jt).appTheme;return Object(a.useEffect)((function(){c.emit("join-self",t._id)}),[]),Object(rt.jsxs)("div",{className:"allchats ".concat(s&&"d-theme"),children:[Object(rt.jsx)(an,{}),Object(rt.jsx)(on,{}),n&&Object(rt.jsx)(un,{})]})})),hn=function(e,t){e.map((function(e){return{text:'The "'.concat(e,'" field cannot be empty'),type:"warning",id:Object(Ue.a)()}})).forEach((function(e,n){return t(Fe(e,2e3*(n+1)))}))};n(425);var bn=Object(me.b)({user:Oe}),mn=Object(i.b)(bn)((function(e){var t=e.user,n=e.dispatch,c="dark"===Object(a.useContext)(jt).appTheme,s=Object(a.useState)({username:"",password:"",email:""}),r=Object(mt.a)(s,2),i=r[0],l=r[1],u=function(e){var t=e.target,n=t.name,a=t.value;l(Object(j.a)(Object(j.a)({},i),{},Object(y.a)({},n,a)))};return t.isLoggedIn?Object(rt.jsx)(be.a,{to:"/dashboard"}):Object(rt.jsxs)("form",{className:"auth u-text-center ".concat(c&&"d-theme"),onSubmit:function(e){e.preventDefault();var t=$t(i);if(t.length)return hn(t,n);n(Qe("signup",i))},children:[Object(rt.jsx)("h1",{className:"heading-primary auth__heading",children:"Create your new account"}),Object(rt.jsxs)("div",{className:"auth__formgroup",children:[Object(rt.jsx)(Pt,{type:"text",className:"auth__forminput textfield",placeholder:"Enter your username",name:"username",value:i.username,onChange:u}),Object(rt.jsx)("i",{className:"fas fa-user auth__formgroup__icon"})]}),Object(rt.jsxs)("div",{className:"auth__formgroup",children:[Object(rt.jsx)(Pt,{type:"email",className:"auth__forminput textfield",placeholder:"Enter your email",name:"email",value:i.email,onChange:u}),Object(rt.jsx)("i",{className:"fas fa-envelope auth__formgroup__icon"})]}),Object(rt.jsxs)("div",{className:"auth__formgroup",children:[Object(rt.jsx)(Pt,{type:"password",className:"auth__forminput textfield",placeholder:"Enter a password",name:"password",value:i.password,onChange:u,autoComplete:"off"}),Object(rt.jsx)("i",{className:"fas fa-lock auth__formgroup__icon"})]}),Object(rt.jsx)("div",{className:"auth__formgroup",children:Object(rt.jsx)("button",{type:"submit",className:"btn btn--curved auth__submit",children:"Create my new account"})}),Object(rt.jsxs)("p",{className:"auth__switch-auth-page",children:["Already have an account? ",Object(rt.jsx)(o.b,{to:"/login",children:"Log in"})]})]})}));n(805);var On=Object(i.b)(null,(function(e){return{removeAlert:function(t){return e(Pe(t))}}}))((function(e){var t=e.id,n=e.type,a=e.text,c=e.removeAlert;return Object(rt.jsxs)("div",{className:"alert alert--".concat(n," alert--alignleft"),children:[Object(rt.jsx)("p",{children:a}),Object(rt.jsx)("span",{className:" alert__remove",onClick:function(){return c(t)},children:"\xd7"})]})}));var fn=function(e){var t=e.alerts;return Object(rt.jsx)("div",{className:"alerts",children:t.map((function(e){return Object(rt.jsx)(On,Object(j.a)({},e),e.id)}))})};var pn=Object(me.b)({user:Oe,alerts:pe}),gn=Object(i.b)(pn)((function(e){var t=e.user,n=e.alerts,c=e.dispatch,s=Object(a.useState)({username:"",password:""}),r=Object(mt.a)(s,2),i=r[0],l=r[1],u=Object(a.useState)(!1),d=Object(mt.a)(u,2),h=(d[0],d[1],"dark"===Object(a.useContext)(jt).appTheme),b=function(e){var t=e.target,n=t.name,a=t.value;l(Object(j.a)(Object(j.a)({},i),{},Object(y.a)({},n,a)))};return t.isLoggedIn?Object(rt.jsx)(be.a,{to:"/dashboard"}):Object(rt.jsxs)(rt.Fragment,{children:[Object(rt.jsx)(fn,{alerts:n}),Object(rt.jsxs)("form",{action:"",className:"auth u-text-center ".concat(h&&"d-theme"),onSubmit:function(e){e.preventDefault();var t=$t(i);if(t.length)return hn(t,c);c(Qe("login",i))},children:[Object(rt.jsx)("h1",{className:"heading-primary auth__heading",children:"Log in"}),Object(rt.jsxs)("div",{className:"auth__formgroup",children:[Object(rt.jsx)(Pt,{type:"text",className:"auth__forminput textfield",placeholder:"Enter your username",name:"username",value:i.username,onChange:b}),Object(rt.jsx)("i",{className:"fas fa-user auth__formgroup__icon"})]}),Object(rt.jsxs)("div",{className:"auth__formgroup",children:[Object(rt.jsx)(Pt,{type:"password",className:"auth__forminput textfield",placeholder:"Enter your password",name:"password",value:i.password,onChange:b}),Object(rt.jsx)("i",{className:"fas fa-lock auth__formgroup__icon"})]}),Object(rt.jsx)("div",{className:"auth__formgroup",children:Object(rt.jsx)("button",{type:"submit",className:"btn btn--curved auth__submit",children:"Log into my account"})}),Object(rt.jsxs)("p",{className:"auth__switch-auth-page",children:["Don't have an account?"," ",Object(rt.jsx)(o.b,{to:"/signup",children:"Create a new account"})]})]})]})})),_n=Object(a.createContext)(),vn=function(e){var t=Object(a.useState)({roomId:null,caller:null,offer:null,answer:null,msgs:[]}),n=Object(mt.a)(t,2),c=n[0],s=n[1];return Object(rt.jsx)(_n.Provider,{value:{session:c,setSession:s},children:e.children})};n(806);var xn=function(){return Object(rt.jsx)("ul",{className:"user-chatlist remove-bullets",children:Object(rt.jsxs)("li",{className:"each-row",children:[Object(rt.jsx)("input",{type:"checkbox",id:"add-chat"}),Object(rt.jsx)("label",{htmlFor:"add-chat",children:Object(rt.jsxs)("div",{className:"chat",children:[Object(rt.jsx)("img",{src:"img/face3.jpg",alt:"",className:"chat__photo pic pic--sm"}),Object(rt.jsx)("span",{className:"chat__name",children:"Mary Branson"})]})})]})})};n(807);Object(i.b)(null,(function(e){return{hidePrompt:function(){return e(at(!1))}}}))((function(e){var t=e.hidePrompt;return Object(rt.jsxs)("div",{className:"modal add-attendee-modal slide-in-from-up-to-center",children:[Object(rt.jsx)("h1",{className:"add-attendee-modal__header",children:"Add someone"}),Object(rt.jsx)(xn,{}),Object(rt.jsxs)("div",{className:"add-attendee-modal__footer",children:[Object(rt.jsx)("button",{className:"btn btn-text-white",children:"Close"}),Object(rt.jsx)("button",{className:"btn btn-white",children:"Add"})]}),Object(rt.jsx)("span",{className:"add-attendee-modal__close",onClick:t,children:"\xd7"})]})})),n(808);var Nn=function(e){var t="dark"===Object(a.useContext)(jt).appTheme,n=e.isViewingAttendees,c=e.setIsViewingAttendees;return Object(rt.jsx)("div",{className:"videocall__chats-and-attendees-nav ".concat(t&&"d-theme"),children:Object(rt.jsx)("span",{className:"chats ".concat(!n&&"nav-item--active"),"data-nav-item":"chat-msgs",onClick:function(){return c(!1)},children:Object(rt.jsx)("i",{className:"fas fa-comments"})})})};n(809);var Cn=Object(me.b)({currentUser:fe}),yn=Object(i.b)(Cn)((function(e){var t=e.msg,n=e.currentUser;console.log("In VideocallMsg, ",t.sender._id,n);var a=t.text,c=t.sender,s=c._id===n._id;return Object(rt.jsxs)("div",{className:"videocall-msg textmsg--".concat(s?"outgoing":"incoming"),children:[Object(rt.jsx)("img",{src:"/img/users/".concat(c.photo),alt:"",className:"videocall-msg__sender-photo pic pic--xsm"}),Object(rt.jsx)("div",{className:"videocall-msg__sender-name",children:s?"You":c.username}),Object(rt.jsx)("p",{className:"videocall-msg__content",children:a})]})}));n(810);var wn=Object(me.b)({currentUser:fe,videoChatRoom:Ae}),Tn=Object(i.b)(wn,null)((function(e){var t=e.currentUser,n=e.videoChatRoom,c=e.dispatch,s="dark"===Object(a.useContext)(jt).appTheme,r=Object(a.useContext)(lt).socket,o=Object(a.useState)(""),i=Object(mt.a)(o,2),l=i[0],u=i[1],d=function(e){null===e||void 0===e||e.preventDefault();var a={text:l,sender:t,room:n};c({type:ee,payload:{msg:a}}),r.emit("send-video-call-msg",a),u("")};return Object(rt.jsxs)("form",{className:"newmsg ".concat(s&&"d-theme"),onSubmit:d,children:[Object(rt.jsx)("input",{type:"text",value:l,className:"newmsg__input",onChange:function(e){return u(e.target.value)},placeholder:"Type a new message here"}),Object(rt.jsx)("span",{className:"newmsg__send icon icon--sm icon--bg-blue",onClick:d,children:Object(rt.jsx)("i",{className:"fas fa-paper-plane"})})]})}));n(811);var kn=Object(me.b)({videoChatMsgs:ke}),Sn=Object(i.b)(kn)((function(e){var t=e.videoChatMsgs,n="dark"===Object(a.useContext)(jt).appTheme;return Object(rt.jsxs)("div",{className:"videocall__chats ".concat(n&&"d-theme"),children:[Object(rt.jsx)(Wt.a,{children:t.map((function(e){return Object(rt.jsx)(yn,{msg:e},Object(Ue.a)())}))}),Object(rt.jsx)(Tn,{})]})}));n(812);var In=function(){return Object(rt.jsx)("ul",{className:"videocall__attendees remove-bullets",children:Object(rt.jsxs)("li",{className:"videocall__attendee",children:[Object(rt.jsxs)("div",{className:"videocall__attendee__details",children:[Object(rt.jsx)("img",{src:"img/face2.jpg",alt:"",className:"videocall__attendee__pic pic pic--xsm"}),Object(rt.jsx)("span",{className:"videocall__attendee__name",children:"Stella Brown"})]}),Object(rt.jsx)("div",{className:"host-actions",children:Object(rt.jsx)("button",{className:"btn btn-md btn-primary",children:"Unmute"})}),Object(rt.jsxs)("div",{className:"videocall__attendee__status-in-call",children:[Object(rt.jsx)("span",{className:"is-muted","data-label":"Mute audio",children:Object(rt.jsx)("i",{className:"fas fa-microphone"})}),Object(rt.jsx)("span",{className:"is-muted","data-label":"Stop video",children:Object(rt.jsx)("i",{className:"fas fa-video"})})]})]})})};n(813);var En=function(){var e="dark"===Object(a.useContext)(jt).appTheme,t=Object(a.useState)(!1),n=Object(mt.a)(t,2),c=n[0],s=n[1];return Object(rt.jsxs)("div",{className:"videocall__chats-and-attendees ".concat(e&&"d-theme"),children:[Object(rt.jsx)("h1",{className:"heading",children:"Group Chat"}),c?Object(rt.jsx)(In,{}):Object(rt.jsx)(Sn,{}),Object(rt.jsx)(Nn,{isViewingAttendees:c,setIsViewingAttendees:s})]})};n(814);var An=function(e){return Object(rt.jsx)("div",{className:"videocall__call__allparticipants",children:e.children})};n(815),n(816);var Rn=Object(me.b)({currentUser:fe,caller:we,callingWho:Te,videoChatRoomId:Ae,rtcOffer:Ce,rtcCandidate:ye,callConnected:xe,callEnded:Se}),Ln=Object(i.b)(Rn)((function(e){var t=e.caller,n=e.callingWho,c=e.videoChatRoomId,s=e.currentUser,r=e.dispatch;console.log("caller, callingWho",t,n);var o=Object(a.useContext)(lt).socket,i=Object(a.useRef)(),l=Object(a.useRef)(),u=Object(a.useState)(null),d=Object(mt.a)(u,2),j=d[0],h=d[1],b=Object(a.useState)(new MediaStream),m=Object(mt.a)(b,2),O=m[0],f=m[1],p=function(){function e(a){var u=this,d=a.isInitiator,j=a.stream;Object(Ge.a)(this,e),this._iceConfig={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},this.connectStreamToVideo=function(){i.current.srcObject=u.stream},this.addOwnTracks=function(){u.stream.getTracks().forEach((function(e){return u.connection.addTrack(e,u.stream)}))},this.handleNegotiationNeeded=function(){var e=Object(Me.a)(Le.a.mark((function e(t){var a;return Le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.connection.createOffer();case 3:return a=e.sent,e.next=6,u.connection.setLocalDescription(a);case 6:console.log("In handleNegotiationNeeded"),console.log(u.connection),o.emit("outgoing-videocall",{caller:s._id,to:n,roomId:c,offer:a}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log("Err in handleNegotiationNeeded");case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),this.handleIceCandidate=function(e){e.candidate&&(console.log("handleIceCandidate from server"),console.log(u.connection),o.emit("candidate-out",{to:u.isInitiator?n:t,candidate:e.candidate}))},this.handleIncomingCandidate=function(e){e&&(u.connection.addIceCandidate(new RTCIceCandidate(e)).catch((function(e){return console.log(e)})),console.log("Receiving incoming candidate"),console.log(u.connection))},this.handleIceConnectionStateChange=function(e){switch(u.connection.iceConnectionState){case"connected":console.log("CONNECTED!");break;case"disconnected":r({type:$});break;case"closed":case"failed":u.closeVideoCall()}},this.handleConnectionStateChange=function(e){switch(u.connection.connectionState){case"connected":console.log("CONNECTED!!"),r({type:Q});break;case"disconnected":r({type:$});break;case"closed":alert("Connection closed")}},this.handleTrackEvent=function(e){var t=Object(mt.a)(e.streams,1)[0];f(t),l.current.srcObject=t,console.log("Incoming track from remote peer")},this.handleRemoveTrack=function(e){},this.handleIceGatheringStateChange=function(e){},this.handleSignalingStateChange=function(e){},this.handleCloseVideoCall=function(){r({type:ce})},this.connection=new RTCPeerConnection(this._iceConfig),this.isInitiator=d||!1,this.stream=j,this.isConnected=!1,this.init()}return Object(Ve.a)(e,[{key:"init",value:function(){this.connectStreamToVideo(),this.addOwnTracks(),this.connection.onnegotiationneeded=this.handleNegotiationNeeded,this.connection.onicecandidate=this.handleIceCandidate,this.connection.ontrack=this.handleTrackEvent,this.connection.onremovetrack=this.handleRemoveTrack,this.connection.oniceconnectionstatechange=this.handleIceConnectionStateChange,this.connection.onconnectionstatechange=this.handleConnectionStateChange,this.connection.onicegatheringstatechange=this.handleIceGatheringStateChange,this.connection.onsignalingstatechange=this.handleSignalingStateChange}}]),e}(),g=function(e){Object(tt.a)(n,e);var t=Object(nt.a)(n);function n(e){var a;return Object(Ge.a)(this,n),(a=t.call(this,e)).handleCallAnswered=function(){var e=Object(Me.a)(Le.a.mark((function e(t){return Le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.connection.setRemoteDescription(new RTCSessionDescription(t));case 2:r({type:q,payload:{answer:t}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a}return n}(p),_=function(e){Object(tt.a)(a,e);var n=Object(nt.a)(a);function a(e){var c;return Object(Ge.a)(this,a),(c=n.call(this,e)).handleIncomingRtcOffer=function(){var e=Object(Me.a)(Le.a.mark((function e(t){return Le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.connection.setRemoteDescription(new RTCSessionDescription(t));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.createRtcAnswer=Object(Me.a)(Le.a.mark((function e(){var n;return Le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.connection.createAnswer();case 2:return n=e.sent,e.next=5,c.connection.setLocalDescription(n);case 5:o.emit("answer-call",{to:t,answer:n});case 6:case"end":return e.stop()}}),e)}))),c}return a}(p),v=function(){var e=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia).bind(window.navigator);return new Promise((function(t,n){e({audio:!0,video:!0},(function(e){h(e),t(e)}),(function(e){return n(e)}))}))},x=function(){var e=Object(Me.a)(Le.a.mark((function e(){var t,n;return Le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v();case 2:t=e.sent,n=new g({isInitiator:!0,stream:t}),console.log("At stage new",n),o.on("candidate-in",n.handleIncomingCandidate),o.on("call-answered",n.handleCallAnswered),o.on("click-end-call-btn",n.handleCloseVideoCall),o.on("user-left-call",n.handleCloseVideoCall);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){var t=Object(Me.a)(Le.a.mark((function t(){var n,a;return Le.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v();case 2:n=t.sent,a=new _({isInitiator:!1,stream:n}),console.log("At stage new",a),o.on("candidate-in",a.handleIncomingCandidate),o.on("click-end-call-btn",a.handleCloseVideoCall),o.on("user-left-call",a.handleCloseVideoCall),a.handleIncomingRtcOffer(e.rtcOffer),a.createRtcAnswer();case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(a.useEffect)((function(){console.log("videoChatRoomId",c),o.emit("join-video-chat-room",c),t===s._id?x():N()}),[]),Object(rt.jsxs)(An,{children:[!e.callConnected&&Object(rt.jsxs)("div",{className:"videocall__call__is-ringing u-text-center u-full-width",children:[Object(rt.jsx)("i",{className:"fas fa-phone-volume callnotify__icon"})," ","Calling..."]}),Object(rt.jsx)("div",{className:"videocall__participant videocall__participant--peer",children:O&&Object(rt.jsx)("video",{src:"",autoPlay:!0,className:"videocall__participant__video",ref:l})}),Object(rt.jsx)("div",{className:"videocall__participant videocall__participant--user ".concat(e.callConnected?"videocall__participant--user-send-to-bottom-right":"videocall__participant--user-fullwidth"),children:j&&Object(rt.jsx)("video",{src:"",autoPlay:!0,muted:!0,className:"videocall__participant__video",ref:i})})]})}));n(817),n(818);var Mn=Object(i.b)()((function(e){var t=e.dispatch;return Object(rt.jsx)("div",{className:"videocall__call__options",onClick:function(){return t(at(!0))}})}));n(819);var Un=Object(me.b)({videoChatRoom:Ae,currentUser:fe}),Dn=Object(i.b)(Un)((function(e){var t=e.videoChatRoom,n=e.currentUser,c=e.dispatch,s=Object(a.useContext)(lt).socket,r="dark"===Object(a.useContext)(jt).appTheme,o=Ct(!1),i=Object(mt.a)(o,3),l=(i[0],i[1],i[2],Ct(!0)),u=Object(mt.a)(l,3),d=(u[0],u[1],u[2],Ct(!0)),j=Object(mt.a)(d,3);return j[0],j[1],j[2],Object(rt.jsx)("div",{className:"videocall__call__controls ".concat(r&&"d-theme"),children:Object(rt.jsx)("span",{className:"videocall__callcontrol with-label with-label-at-top","data-label":"End call",onClick:function(){s.emit("click-end-call-btn",n._id),s.emit("leave-call",t),c({type:ce})},children:Object(rt.jsx)("i",{className:"fas fa-phone","data-label":"End call"})})})}));n(820);var Pn=Object(me.b)({isFullscreen:Ie}),Fn=Object(i.b)(Pn)((function(e){var t=e.isFullscreen,n=e.dispatch,c=Object(a.useContext)(jt),s=c.appTheme,r=c.toggleTheme,o="dark"===s;return Object(rt.jsxs)("div",{className:"videocall__call__more-actions",children:[Object(rt.jsx)("input",{type:"checkbox",id:"more-actions"}),Object(rt.jsxs)("label",{htmlFor:"more-actions",children:[Object(rt.jsx)("span",{children:Object(rt.jsx)("i",{className:"fas fa-ellipsis-v"})}),Object(rt.jsxs)("ul",{className:"videocall__call__options remove-bullets ".concat(o&&"d-theme"),children:[Object(rt.jsxs)("li",{className:"videocall__call__option",onClick:t?function(){return n({type:ne})}:function(){return n({type:te})},children:[Object(rt.jsx)("i",{className:"fas fa-".concat(t?"compress":"expand","-arrows-alt")}),Object(rt.jsx)("span",{children:t?"Exit full screen":"Zoom to fullscreen"})]}),Object(rt.jsxs)("li",{className:"videocall__call__option",onClick:r,children:[Object(rt.jsx)("i",{className:"fas fa-sun"}),Object(rt.jsxs)("span",{children:["Switch to ",o?"light":"dark"," theme"]})]})]})]})]})}));var Gn=function(){return Object(rt.jsxs)("div",{className:"videocall__call__footer",children:[Object(rt.jsx)(Mn,{}),Object(rt.jsx)(Dn,{}),Object(rt.jsx)(Fn,{})]})};n(821);var Vn=function(e){var t=e.chatId;return Object(rt.jsxs)("div",{className:"videocall__call videocall__call--peer-to-peer",children:[Object(rt.jsx)(Ln,{chatId:t}),Object(rt.jsx)(Gn,{})]})};n(822);var Hn=Object(me.b)({isOnVideoCall:Ne,isFullscreen:Ie,isAddingToCall:Ee}),Wn=Object(i.b)(Hn)((function(e){var t=e.chatId,n=(e.dispatch,Object(Ot.a)(e,["chatId","dispatch"])),c=n.isOnVideoCall,s=(n.isAddingToCall,n.isFullscreen),r="dark"===Object(a.useContext)(jt).appTheme;return Object(rt.jsxs)(vn,{children:[Object(rt.jsxs)("div",{className:"videocall-modal ".concat(c&&"videocall-modal--zoomed-into-view"," ").concat(s&&"videocall-modal--fullscreen"," ").concat(r&&"d-theme"),children:[Object(rt.jsx)(En,{}),Object(rt.jsx)(Vn,{chatId:t})]}),Object(rt.jsx)(ft,{showIf:c})]})}));n(823);function Bn(){return Object(rt.jsx)("div",{className:"default-img",children:Object(rt.jsx)("img",{src:"/img/helomi-bg.JPG"})})}var zn=Object(me.b)({alerts:pe,user:Oe,isOnVideoCall:Ne,caller:we}),Jn=Object(be.g)(Object(i.b)(zn)((function(e){var t=e.alerts,n=e.user,c=e.isOnVideoCall,s=e.dispatch;return Object(a.useEffect)((function(){s(function(){var e=Object(Me.a)(Le.a.mark((function e(t){var n,a;return Le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=v(),e.next=3,We.authenticateToken(n);case 3:"success"===(a=e.sent).status?(t(Ke(a.user,n,a.twilioAccessToken)),t(Be(a.user.friends))):t(Ye());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),Object(rt.jsx)(bt,{children:Object(rt.jsxs)(ut,{children:[Object(rt.jsx)(fn,{alerts:t}),Object(rt.jsx)(Mt,{}),Object(rt.jsx)(be.b,{exact:!0,path:"/",component:Dt}),Object(rt.jsx)(be.b,{exact:!0,path:"/login",component:gn}),Object(rt.jsx)(be.b,{exact:!0,path:"/signup",component:mn}),Object(rt.jsx)(be.b,{path:"/dashboard",render:function(){return n.isLoggedIn?Object(rt.jsx)(jn,{}):Object(rt.jsx)(be.a,{to:"/login"})}}),Object(rt.jsx)(be.b,{exact:!0,path:"/dashboard",component:Bn}),Object(rt.jsx)(be.b,{exact:!0,path:"/dashboard/chats/:id",render:function(e){return n.isLoggedIn?Object(rt.jsx)(tn,Object(j.a)({},e)):Object(rt.jsx)(be.a,{to:"/login"})}}),c&&Object(rt.jsx)(Wn,{})]})})})));r.a.render(Object(rt.jsx)(i.a,{store:he,children:Object(rt.jsx)(o.a,{children:Object(rt.jsx)(Jn,{})})}),document.getElementById("root"))}},[[825,1,2]]]);
//# sourceMappingURL=main.47b33f76.chunk.js.map